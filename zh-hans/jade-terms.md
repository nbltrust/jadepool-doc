### 订单
订单是Jadepool Hub处理请求和记录交易的基本单位。是Jadepool Hub所有业务的根本依据。

### 订单类型
订单类型 | 说明
--------- | ------- 
充值(DEPOSIT) | 检测到用户向Jadepool Hub生成的充值地址转账正确币种类型而生成的订单类型。
提现(WITHDRAW) | 收到提现请求后生成的订单类型。
热转冷(SWEEP) | 余额高于高水位设置，自动触发热转冷转账而生成的订单。
冷转热(RECHARGE) | 检测到从冷钱包地址向热主地址转账而生成的订单类型。
未知入账(RECHARGE_UNEXPECTED) | 检测到内部地址以外的地址直接向热主地址的转账，或者充值地址收到memo填写错误的转账而生成的订单类型。
空投(AIRDROP) | 检测到从设置的空投地址发起的转账而生成的订单类型。空投来源地址可以设置多个。
内部出账(SWEEP_INTERNAL) | 内部地址向内部地址发起的转账（内部地址包括热主地址和充值地址），该类型是转出而生成的订单。
内部入账(RECHARGE_INTERNAL) | 为审计结果的准确性，每个内部出账订单对应一笔内部入账订单。
特殊入账(RECHARGE_SPECIAL) | 目前只有NEO的claim gas行为应用此订单类型。
区块链请求(SYSTEM_CALL) | 执行某些区块链行为产生的订单，区块链行为内容见下表。
本金回收(PRINCIPAL_FUND) | 检测到回收抵押本金生成的订单。
收益(INTEREST_FUND) | 检测到收益生成的订单。
抵押(DELEGATE) | 申请抵押生成的订单。
解抵押(UNDELEGATE) | 申请解抵押生成的订单。
撤销(REVERT) | 由于用户错误操作导致订单类型识别错误需要将原订单撤销并生成新的正确类型订单。此订单类型现仅用于用户充值时将memo填错而导致生成的未知入账(RECHARGE_UNEXPECTED)订单。

<br>

区块链行为 | 说明
--------- | ------- 
打散UTXO(UTXO_SCATTER) | 在admin手动触发的utxo类币种向各内部地址转账以形成多个可用utxo的行为。
授权转币(APPROVE) | 充值地址授权热主地址可动用其余额的行为。
换抵押(REDELEGATE) | 从一个超级节点换投票/抵押到另一个超级节点。
申请收益(CLAIM_REWARD) | 申请拿回抵押获取的收益。
设置收益地址(SET_REWARD_ADDRESS) | 设置拿回抵押收益的收益地址。

<br>

### 订单状态

请看[入账状态机示意图](incoming.html)和[出账状态机示意图](outgoing.html)。

订单状态 | 说明
--------- | ------- 
未处理(init) | 指Jadepool Hub已收到提现请求或已自主生成出账订单，但还未开始处理。
预处理(holding) | 将交易发上链前的预处理状态，订单长时间处于holding状态会被认为是异常订单并需要人工介入。
已发送(online) | 指Jadepool Hub已成功向节点发送交易（出账类订单）。
已上链(pending) | 指交易已成功上链并已被打包在某一区块中，但仍需一定数量的新区块产生以确认交易不可逆。
不可逆(done) | 订单最终状态，指交易已达到足够的区块确认数，交易不可逆。
失败(failed) | 订单最终状态，指交易失败。

<br>

### 入账、出账
**入账**：增加Jadepool Hub热钱包余额的订单类型，包括：充值、冷转热、未知入账、内部入账、空投、本金回收、收益、解抵押、特殊入账
<br>
**出账**：减少Jadepool Hub热钱包余额的订单类型，包括：提现、热转冷、内部出账、抵押

### 高水位、目标水位、低水位
**高水位**：Jadepool Hub热钱包内可存放的金额上限，超过该水位则和“目标水位”参数搭配控制转入冷钱包的金额。每个开启的token都可配置。
<br>
**目标水位**：当一个币种在Jadepool Hub热钱包内的余额超过高水位，转一部分金额去冷钱包后在热钱包剩余的金额。例如：若高水位为0.4BTC，目标水位为0.2BTC，现Jadepool Hub热钱包有0.5BTC，则应转0.3BTC到冷钱包，剩余0.2BTC在Jadepool Hub热钱包。每个开启的token都可配置。
<br>
**低水位**：Jadepool Hub热钱包的金额下限，若余额低于此配置，则会发送告警邮件。每个开启的token都可配置。

### 热主地址
热钱包主要地址。热主地址不是充值地址，不会提供给用户充值（除memo充值模式的区块链），一般被用来汇总、找零或补充热钱包余额。

### 汇总
汇总是把用户向充值地址充值的金额转移到热主地址。以ETH为例，ETH的每个地址都有nonce（出账交易的递增序列号），并且交易转账来源地址只能有一个。Jadepool Hub为了方便管理地址和交易，将热主地址作为出账交易的唯一来源地址。所以只有在热主地址的余额才是真正可以被使用的金额（即可用余额），充值地址的余额被汇总到热主地址以后才能被使用。

### 总余额、可用余额、不可用余额/散落余额、冻结金额、解冻中金额
**总余额**：等于可用余额和不可用余额的总和。
<br>
**可用余额**：可以用作出账的余额。
<br>
**不可用余额**：不可以用作出账的余额，即对于多地址模式的币种来说散落在充值地址的余额总和。memo充值模式的币种的不可用余额总为0。
<br>
**冻结金额**：已被抵押(delegate/stake)的金额总和。冻结金额不包含在总余额中。
<br>
**解冻中金额**：正在解抵押(undelegate/unstake)的金额总和。因为每个链对解抵押的时间要求不一样，可能短至三天，长至二十一天，所以称之为解冻中。解冻中金额不包含在总余额中。

### 回调
回调即Jadepool Hub通知应用方订单状态和审计结果的方式。对于每一个热钱包下的每一个服务（appid），应用方可对每种订单类型设置回调通知地址。

### 审计
Jadepool Hub审计的基本原理是按照应用方调用审计API传入的时间戳在数据库中找出出块时间最相近的区块，找出区块号（交易被打包的区块）在该区块之前的达到最终状态的所有未被审计过的订单并进行审计计算。

### ECC
ECC是Jadepool Hub为保证通信安全而在内部各组件之间还有和应用方之间通信使用的加密算法。作为信息发送方的组件应有私钥对信息签名，而作为接收方的组件则需要有消息发送方的公钥以对信息进行验签。以Jadepool Hub和应用方的通信为例，两方都需要发送并接收信息，所以Jadepool Hub应配有应用方的公钥，应用方也应配有Jadepool Hub的公钥。Jadepool Hub的公钥可以在admin的Jadepool服务页面获得，配置应用方公钥则应在指定钱包的“应用管理”页面对指定的应用服务（APP ID）进行添加设置。

### 热钱包
为方便客户多个产品对接，Jadepool Hub支持创建多个热钱包。其基本原理是每个热钱包的地址衍生路径所在帐户不同，不仅提高了安全性，也实现各钱包资金隔离。所以各个热钱包的地址是从一个seed衍生而来，但是所在帐户不一样，地址之间并无联系。

### APP ID
在每个热钱包下可以创建多个APP ID，即方便对接需要使用同一个热钱包的多个服务。在Admin可以对每个APP ID针对每个订单类型设置不同的回调地址。

